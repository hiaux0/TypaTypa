<!-- A B C D 1 2 3 4 -->

<import from="./grid-cell/grid-cell"></import>
<main ref="gridTestContainerRef" class="grid-test-container">
  <!-- Toolbar -->
  <section>
    <button click.trigger="addPanel()">Add Panel</button>
  </section>

  <!-- Function Bar -->
  <section class="function-bar-container">
    <div class="cell-range-display">${orderedSelectedRangeToString}</div>
    <div class="function-bar"></div>
  </section>

  <!-- Spreadsheet -->
  <section ref="spreadsheetContainerRef" class="spreadsheet-container">
    <!-- 1/3 Column Header -->
    <section class="column-container row-header">
      <div class="cell column-header-corner"></div>
      <div class="cell-header" repeat.for="rowIndex of rowSize">
        ${rowIndex}
      </div>
    </section>

    <!-- 2/3 Columns and Rows -->
    <section class="column-container" repeat.for="columnIndex of columnSize">
      <div class="cell-header column-header">
        <!-- ${numberToAlphabet(columnIndex)} -->
        ${(columnIndex)}
      </div>
      <div class="row-container" repeat.for="rowIndex of rowSize">
        <!-- Cell -->
        <grid-cell
          row.bind="rowIndex"
          column.bind="columnIndex"
          selected.bind="selectedMap[EV_CELL_SELECTED(columnIndex, rowIndex)]"
          pointerdown.trigger="startMouseDragGridCell(columnIndex,rowIndex)"
          pointerover.trigger="onMouseOverGridCell(columnIndex, rowIndex)"
          pointerup.trigger="onMouseUpGridCell()"
        ></grid-cell>
      </div>
    </section>

    <!-- 3/3 Panels -->
    <section ref="panelContainerRef" class="panel-container">
      <div
        class="panel-item-container"
        repeat.for="panel of gridPanels"
        style="
          top: ${(panel.row) * CELL_HEIGHT}px;
          left: ${(panel.col) * CELL_WIDTH}px;
          width: ${(panel.width ?? 1) * CELL_WIDTH}px;
          height: ${(panel.height ?? 1) * CELL_HEIGHT}px;
        "
        draggable="drag-container.bind: spreadsheetContainerRef; cell-width.bind: CELL_WIDTH; cell-height.bind: CELL_HEIGHT; on-drag-end.bind: updatePanelCoords(panel);"
        data-panel-id.bind="panel.id"
        pointerdown.trigger="onPanelClicked(panel)"
      >
        <!-- <button class="panel-item">Panel ${$index}</button> -->
        <textarea
          style="
            width: ${(panel.width ?? 1) * CELL_WIDTH}px;
            height: ${(panel.height ?? 1) * CELL_HEIGHT}px;
            overflow: hidden;
          "
          tabindex="${$index + 1}"
          autosize="width-step.bind: CELL_WIDTH; height-step.bind: CELL_HEIGHT; on-width-autosize.bind: onTextareaWidthChanged(panel); on-height-autosize.bind: onTextareaHeightChanged(panel);"
          wrap="off"
        ></textarea>
        <div class="options-container">
          <button class="delete" click.trigger="deletePanel(panel)">x</button>
        </div>
      </div>
    </section>
  </section>
</main>
